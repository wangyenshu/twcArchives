/***
|''Name:''|~TaggerPlugin|
|''Version:''|1.0.0 (2006-05-10)|
|''Source:''|http://lewcid.googlepages.com/lewcid.html/#TaggerPlugin|
|''Author:''|SaqImtiaz|
|''Description:''|Provides a drop down listing current tiddler tags, and allowing toggling of tags.|
|''Documentation:''|[[TaggerPluginDocumentation]]|
|''Source Code:''|[[TaggerPluginSource]]|
|''~TiddlyWiki:''|Version 2.0.8 or better|
***/
// /%
config.tagger={defaults:{label:"Tags: ",tooltip:"Manage tiddler tags",taglist:"true",excludeTags:"",notags:"tiddler has no tags",aretags:"current tiddler tags:",toggletext:"add tags:"}};config.macros.tagger={};config.macros.tagger.arrow=(document.all?"▼":"▾");config.macros.tagger.handler=function(_1,_2,_3,_4,_5,_6){var _7=config.tagger.defaults;var _8=_5.parseParams("tagman",null,true);var _9=((_8[0].label)&&(_8[0].label[0])!=".")?_8[0].label[0]+this.arrow:_7.label+this.arrow;var _a=((_8[0].tooltip)&&(_8[0].tooltip[0])!=".")?_8[0].tooltip[0]:_7.tooltip;var _b=((_8[0].taglist)&&(_8[0].taglist[0])!=".")?_8[0].taglist[0]:_7.taglist;var _c=((_8[0].exclude)&&(_8[0].exclude[0])!=".")?(_8[0].exclude[0]).readBracketedList():_7.excludeTags.readBracketedList();if((_8[0].source)&&(_8[0].source[0])!="."){var _d=_8[0].source[0];}if(_d&&!store.getTiddler(_d)){return false;}var _e=function(e){if(!e){var e=window.event;}var _11=Popup.create(this);var _12=store.getTags();var _16=new Array();for(var i=0;i<_12.length;i++){_16.push(_12[i][0]);}if(_d){var _15=store.getTiddler(_d);var _16=_15.tags.sort();}var _17=_6.tags.sort();var _18=function(_19,_1a,_1b){var sp=createTiddlyElement(createTiddlyElement(_11,"li"),"span",null,"tagger");var _1d=createTiddlyButton(sp,_19,_1b+" '"+_1a+"'",taggerOnToggle,"button","toggleButton");_1d.setAttribute("tiddler",_6.title);_1d.setAttribute("tag",_1a);insertSpacer(sp);createTagButton(sp,_1a);};createTiddlyElement(_11,"li",null,"listTitle",(_6.tags.length==0?_7.notags:_7.aretags));for(var t=0;t<_17.length;t++){_18("[x]",_17[t],"remove tag ");}createTiddlyElement(createTiddlyElement(_11,"li"),"hr");if(_b!="false"){createTiddlyElement(_11,"li",null,"listTitle",_7.toggletext);for(var i=0;i<_16.length;i++){if(!_6.tags.contains(_16[i])&&!_c.contains(_16[i])){_18("[ ]",_16[i],"add tag ");}}createTiddlyElement(createTiddlyElement(_11,"li"),"hr");}var _20=createTiddlyButton(createTiddlyElement(_11,"li"),("Create new tag"),null,taggerOnToggle);_20.setAttribute("tiddler",_6.title);if(_d){_20.setAttribute("source",_d);}Popup.show(_11,false);e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation();}return (false);};createTiddlyButton(_1,_9,_a,_e,"button","taggerDrpBtn");};window.taggerOnToggle=function(e){var tag=this.getAttribute("tag");var _23=this.getAttribute("tiddler");var _24=store.getTiddler(_23);if(!tag){var _25=prompt("Enter new tag:","");if(_25!=""&&_25!=null){var tag=_25;if(this.getAttribute("source")){var _27=store.getTiddler(this.getAttribute("source"));_27.tags.pushUnique(_25);}}else{return false;}}if(!_24||!_24.tags){store.saveTiddler(_23,_23,"",config.options.txtUserName,new Date(),tag);}else{if(_24.tags.find(tag)==null){_24.tags.push(tag);}else{if(!_25){_24.tags.splice(_24.tags.find(tag),1);}}story.saveTiddler(_23);}story.refreshTiddler(_23,null,true);if(config.options.chkAutoSave){saveChanges();}return false;};setStylesheet(".tagger a.button {font-weight: bold;display:inline; padding:0px;}\n"+".tagger #toggleButton {padding-left:2px; padding-right:2px; margin-right:1px; font-size:110%;}\n"+"#nestedtagger {background:#2E5ADF; border: 1px solid #0331BF;}\n"+".popup .listTitle {color:#000;}\n"+"","TaggerStyles");window.lewcidTiddlerSwapTag=function(_28,_29,_2a){for(var i=0;i<_28.tags.length;i++){if(_28.tags[i]==_29){_28.tags[i]=_2a;return true;}}return false;};window.lewcidRenameTag=function(e){var tag=this.getAttribute("tag");var _2e=prompt("Rename tag '"+tag+"' to:",tag);if((_2e==tag)||(_2e==null)){return false;}if(store.tiddlerExists(_2e)){if(confirm(config.messages.overwriteWarning.format([_2e.toString()]))){story.closeTiddler(_2e,false,false);}else{return null;}}tagged=store.getTaggedTiddlers(tag);if(tagged.length!=0){for(var j=0;j<tagged.length;j++){lewcidTiddlerSwapTag(tagged[j],tag,_2e);}}if(store.tiddlerExists(tag)){store.saveTiddler(tag,_2e);}if(document.getElementById("tiddler"+tag)){var _30=document.getElementById(story.idPrefix+tag);var _31=story.positionTiddler(_30);var _32=document.getElementById(story.container);story.closeTiddler(tag,false,false);story.createTiddler(_32,_31,_2e,null);story.saveTiddler(_2e);}if(config.options.chkAutoSave){saveChanges();}return false;};window.onClickTag=function(e){if(!e){var e=window.event;}var _35=resolveTarget(e);var _36=(!isNested(_35));if((Popup.stack.length>1)&&(_36==true)){Popup.removeFrom(1);}else{if(Popup.stack.length>0&&_36==false){Popup.removeFrom(0);}}var _37=(_36==false)?"popup":"nestedtagger";var _38=createTiddlyElement(document.body,"ol",_37,"popup",null);Popup.stack.push({root:this,popup:_38});var tag=this.getAttribute("tag");var _3a=this.getAttribute("tiddler");if(_38&&tag){var _3b=store.getTaggedTiddlers(tag);var _3c=[];var li,r;for(r=0;r<_3b.length;r++){if(_3b[r].title!=_3a){_3c.push(_3b[r].title);}}var _3e=config.views.wikified.tag;if(_3c.length>0){var _3f=createTiddlyButton(createTiddlyElement(_38,"li"),_3e.openAllText.format([tag]),_3e.openAllTooltip,onClickTagOpenAll);_3f.setAttribute("tag",tag);createTiddlyElement(createTiddlyElement(_38,"li"),"hr");for(r=0;r<_3c.length;r++){createTiddlyLink(createTiddlyElement(_38,"li"),_3c[r],true);}}else{createTiddlyText(createTiddlyElement(_38,"li",null,"disabled"),_3e.popupNone.format([tag]));}createTiddlyElement(createTiddlyElement(_38,"li"),"hr");var h=createTiddlyLink(createTiddlyElement(_38,"li"),tag,false);createTiddlyText(h,_3e.openTag.format([tag]));createTiddlyElement(createTiddlyElement(_38,"li"),"hr");var _41=createTiddlyButton(createTiddlyElement(_38,"li"),("Rename tag '"+tag+"'"),null,lewcidRenameTag);_41.setAttribute("tag",tag);}Popup.show(_38,false);e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation();}return (false);};if(!window.isNested){window.isNested=function(e){while(e!=null){var _43=document.getElementById("contentWrapper");if(_43==e){return true;}e=e.parentNode;}return false;};};config.shadowTiddlers.TaggerPluginDocumentation="The documentation is available [[here.|http://lewcid.googlepages.com/lewcid.html#TaggerPluginDocumentation]]";config.shadowTiddlers.TaggerPluginSource="The uncompressed source code is available [[here.|http://lewcid.googlepages.com/lewcid.html#TaggerPluginSource]]";
// %/